<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>CYIN</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">CIYN<sup></sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-fw fa-paperclip"></i>
                    <span>전체 보고서</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">


            <!-- Heading -->
            <div class="sidebar-heading">
                메뉴
            </div>

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
                    aria-expanded="true" aria-controls="collapseTwo">
                    <i class="fas fa-fw fa-award"></i>
                    <span>강의 소개 및 평가</span>
                </a>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header"></h6>
                        <a class="collapse-item" href="search-result.html">강의 소개만 보기</a>
                        <a class="collapse-item" href="course-evaluations.html">강의 평가 보기</a>
                    </div>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="insert-grade.html">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>학점예측 및 입력</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
               회원관련
            </div>

            <!-- Nav Item - Pages Collapse Menu -->
            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <i class="fas fa-fw fa-folder"></i>
                    <span>회원정보메뉴</span>
                </a>
                <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">회원정보관리</h6>
                        <a class="collapse-item" href="login.html">로그인</a>
                        <a class="collapse-item" href="register.html">회원가입</a>
                        <a class="collapse-item" href="forgot-password.html">회원정보수정</a>
                        <div class="collapse-divider"></div>
                        <h6 class="collapse-header">강의 관련</h6>
                        <a class="collapse-item" href="utilities-border.html">강의 소개</a>
                        <a class="collapse-item" href="blank.html">강의 평가</a>
                    </div>
                </div>
            </li>


            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

            <!-- Sidebar Message -->
            <div class="sidebar-card">
                <img class="sidebar-card-illustration mb-2" src="img/undraw_rocket.svg" alt="">
                <a class="btn btn-primary btn-sm" href="https://cyber.ewha.ac.kr/local/ubion/user/grade.php">사이버캠퍼스 성적확인</a>
                

            </div>

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Search -->
                    <form
                        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="강의를 찾아보세요..."
                                aria-label="Search" aria-describedby="basic-addon2">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <li class="nav-item dropdown no-arrow d-sm-none">
                            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-search fa-fw"></i>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                                aria-labelledby="searchDropdown">
                                <form class="form-inline mr-auto w-100 navbar-search">
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-light border-0 small"
                                            placeholder="Search for..." aria-label="Search"
                                            aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button">
                                                <i class="fas fa-search fa-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>


                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">이화연</span>
                                <img class="img-profile rounded-circle"
                                    src="img/undraw_profile.svg">
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    프로필보기
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    회원정보
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Activity Log
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    로그아웃
                                </a>
                            </div>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->


                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">2020-2학기 수강 과목 학점 예측</h1>
                    </div>

                    <div class="row">

                        <div class="col-xl-8 col-lg-7">


                            <div class='card shadow mb-4'>
                                <div class='card-header py-3'> 
                                    <h6 class='m-0 font-weight-bold text-primary'>성적 위치 확인하기</h6>
                                </div>
                                <div class='card-body' >
                                </div >
                                <div id="canvasContainer" height="300px">
                                    <canvas id="GradeChart" height= "300px" ></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-4 col-lg-5" id = "ll">


                        </div>

                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2020</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

	<script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-firestore.js"></script>
    <script>
    var firebaseConfig = {
        apiKey: "AIzaSyCJ63RHBc0LMxSKn3mCubjeGpAqXtcdG_Q",
        authDomain: "ciyn-7bfbc.firebaseapp.com",
        databaseURL: "https://ciyn-7bfbc.firebaseio.com",
        projectId: "ciyn-7bfbc",
        storageBucket: "ciyn-7bfbc.appspot.com",
        messagingSenderId: "251105086649",
        appId: "1:251105086649:web:ada3d55a17def3c0b7df68",
        measurementId: "G-4N9321T8ST"
    };
      // Initialize Firebase
      var str="";
      firebase.initializeApp(firebaseConfig);
      const database = firebase.firestore();
      const usersCollection = database.collection('user').where('userid', '==','user1');
      const list_subject = document.getElementById("ll");
      usersCollection.get().then(function(querySnapshot){
        querySnapshot.forEach(function(doc){
            str = "";
            var dat = doc.data()['term']['2020-2'];
            for (var x in dat){
                str += "<div class='card shadow mb-4'> <div class='card-header py-3'><h6 class='m-0 font-weight-bold text-primary'>"+x+" ("+dat[x]['prof']+" 교수님)"+"</h6></div><div class = 'card-body'>";
                if(dat[x]['mid']== ""){
                    str += "<label>중간고사</label><br><div class ='row'> <input type = 'text' class='form-control-score bg-light-2 border-0 small' placeholder='중간고사 성적입력' aria-label='Search' aria-describedby='basic-addon2'readonly> <div class='input-group-append'> <button class='btn-score btn-primary ' onclick = 'profradio(\"mid\")' type='button'><span class='icon text-gray-600'></span><span class='text'> 성적 확정</span></button></div><br></div><hr>"
                }else{
                    str += "<label>기말고사</label><div class ='row'> <input type = 'text' class='form-control-score bg-light-2 border-0 small' placeholder='"+dat[x]['mid']+"' aria-label='Search' aria-describedby='basic-addon2'readonly> <div class='input-group-append'> <button class='btn-score btn-danger btn-icon-split' onclick = 'profradio(\"mid\")' type='button'></span><span class='text'> 변경 불가</span></button></div><br></div><hr>"
                }
                if(dat[x]['fin']== ""){
                    str += "<label>기말고사</label><div class ='row'> <input type = 'text' class='form-control-score bg-light-2 border-0 small' placeholder='기말고사 성적입력' aria-label='Search' aria-describedby='basic-addon2'readonly> <div class='input-group-append'> <button class='btn-score btn-primary' onclick = 'profradio(\"fin\")' type='button'><span class='icon text-gray-600'></span><span class='text'> 성적 확정</span></button></div><br></div><hr>"
                }else{
                    str += "<label>기말고사</label><div class ='row'> <input type = 'text' class='form-control-score bg-light-2 border-0 small' placeholder='"+dat[x]['fin']+"' aria-label='Search' aria-describedby='basic-addon2'readonly> <div class='input-group-append'> <button class='btn-score btn-danger btn-icon-split' onclick = 'profradio(\"fin\")' type='button'></span><span class='text'> 변경 불가</span></button></div><br></div><hr>"
                }
                str += "<br></form><a href='#' class='btn btn-success btn-icon-split'onclick = 'sum_grade()' ><span class='icon text-white-50'><i class='fas fa-check'></i></span><span class='text'>전체 성적 위치 확인하기</span></a></div></div>";
            }
            list_subject.innerHTML += str;
        })
      });
      
    var ctx = document.getElementById('GradeChart').getContext('2d');
    var myRadarChart;
    function profradio(sem){
        eval_grade = 0,eval_hard = 0,eval_talk = 0,eval_teach = 0, eval_num=0;
        //console.log(thisid);
        const revs = database.collection('grade').where('name', '==', '컴퓨터구조');//나중에 thisid로 바뀌어야
        revs.get().then(snapshot =>{
                    snapshot.docs.forEach(docss =>{
                        console.log(docss.data());
                        var dat_fin = docss.data()['2019-2']['조동섭']['score'][sem];
                        var box_val = getBoxValues(dat_fin);
                        console.log(box_val);
                        var labels = [box_val.t1+"~",box_val.t2+"~",box_val.t3+"~", box_val.t4+"~",box_val.t5+"~",box_val.t6+"~",box_val.t7+"~",box_val.t8+"~",box_val.t9+"~",box_val.t10+"~"];
                        console.log(labels);
                        var labelss = [box_val.t1,box_val.t2,box_val.t3, box_val.t4,box_val.t5,box_val.t6,box_val.t7,box_val.t8,box_val.t9,box_val.t10];
                        var last_dat = hiss(labelss, dat_fin);

var data = {
        labels:labels,
        datasets: [{
            data: last_dat,
            backgroundColor: [
                'rgba(255, 0, 0, 0.6)',
                'rgba(255, 0, 0, 0.6)',
                'rgba(255, 48, 0, 0.6)',
                'rgba(255, 48, 0, 0.6)',
                'rgba(255, 102, 0, 0.6)',
                'rgba(255, 102, 0, 0.6)',
                'rgba(255, 154, 0, 0.6)',
                'rgba(255, 205, 0, 0.6)',                
                'rgba(255, 255, 0, 0.6)'
            ]
        }]
    };
var option = {
tooltips: {
         enabled: false
    },
	 legend: {
        			display: false
				    }
};

var myBarChart = new Chart.Bar(ctx,{
	data:data,
  options:option
});

                    })
                });
                document.cookie="";
    }

function getPercentile(data, percentile) {
    data.sort(function(a,b){return a-b;});
    var index = (percentile/100) * data.length;
    var result;
    if (Math.floor(index) == index) {
         result = (data[(index-1)] + data[index])/2;
    }
    else {
        result = data[Math.floor(index)];
    }
    return result;
}
    function getBoxValues(data) {
    var boxValues = {};
    boxValues.low = Math.round(Math.min.apply(Math,data));
    boxValues.t1 = Math.round(Math.min.apply(Math,data));
    boxValues.t2 = Math.round((getPercentile(data, 25)+Math.min.apply(Math,data))/2);
    boxValues.t3 = Math.round(getPercentile(data, 25));
    boxValues.t4 = Math.round((getPercentile(data, 25)*5+getPercentile(data, 75)*1)/6);
    boxValues.t5 = Math.round((getPercentile(data, 25)*4+getPercentile(data, 75)*2)/6);
    boxValues.t6 = Math.round((getPercentile(data, 25)*3+getPercentile(data, 75)*3)/6);
    boxValues.t7 =  Math.round((getPercentile(data, 25)*2+getPercentile(data, 75)*4)/6);
    boxValues.t8 =  Math.round((getPercentile(data, 25)*1+getPercentile(data, 75)*5)/6);
    boxValues.t9     = Math.round(getPercentile(data, 75));
    boxValues.t10     = Math.round((getPercentile(data, 75)+Math.max.apply(Math,data))/2);
    boxValues.high   = Math.round(Math.max.apply(Math,data));
    return boxValues;
}

function hiss(lab, dat){
    var hist = [0,0,0,0,0,0,0,0,0,0];
    console.log(lab);console.log(dat);
    for(var i in dat){
        if(lab[0]<=dat[i] && dat[i]< lab[1]){
            hist[0]++;
        }else if(lab[1]<=dat[i] && dat[i]< lab[2]){
            hist[1]++;
        }else if(lab[2]<=dat[i] && dat[i]< lab[3]){
            hist[2]++;
        }else if(lab[3]<=dat[i] && dat[i]< lab[4]){
            hist[3]++;
        }else if(lab[4]<=dat[i] && dat[i]< lab[5]){
            hist[4]++;
        }else if(lab[5]<=dat[i] && dat[i]< lab[6]){
            hist[5]++;
        }else if(lab[6]<=dat[i] && dat[i]< lab[7]){
            hist[6]++;
        }else if(lab[7]<=dat[i] && dat[i]< lab[8]){
            hist[7]++;
        }else if(lab[8]<=dat[i] && dat[i]< lab[9]){
            hist[8]++;
        }else{
            hist[9]++;
        }
    }
    console.log(hist);
    return hist;
}

    function sum_grade(){
        eval_grade = 0,eval_hard = 0,eval_talk = 0,eval_teach = 0, eval_num=0;
        //console.log(thisid);
        const revs = database.collection('grade').where('name', '==', '컴퓨터구조');//나중에 thisid로 바뀌어야
        revs.get().then(snapshot =>{
                    snapshot.docs.forEach(docss =>{
                        console.log(docss.data());
                        var dat_mid = docss.data()['2019-2']['조동섭']['score']['mid'];
                        var dat_fin = docss.data()['2019-2']['조동섭']['score']['fin'];
                        var hist = [];
                        for (var i in dat_fin){
                            hist[i]= dat_mid[i]+dat_fin[i];
                        }
                        var box_val = getBoxValues(hist);
                        console.log(box_val);
                        var labels = [box_val.t1+"~",box_val.t2+"~",box_val.t3+"~", box_val.t4+"~",box_val.t5+"~",box_val.t6+"~",box_val.t7+"~",box_val.t8+"~",box_val.t9+"~",box_val.t10+"~"];
                        console.log(labels);
                        var labelss = [box_val.t1,box_val.t2,box_val.t3, box_val.t4,box_val.t5,box_val.t6,box_val.t7,box_val.t8,box_val.t9,box_val.t10];
                        var last_dat = hiss(labelss, hist);

var data = {
        labels: labels,
        datasets: [{
            data: last_dat,
            backgroundColor: [
                'rgba(255, 0, 0, 0.6)',
                'rgba(255, 0, 0, 0.6)',
                'rgba(255, 48, 0, 0.6)',
                'rgba(255, 48, 0, 0.6)',
                'rgba(255, 102, 0, 0.6)',
                'rgba(255, 102, 0, 0.6)',
                'rgba(255, 154, 0, 0.6)',
                'rgba(255, 205, 0, 0.6)',                
                'rgba(255, 255, 0, 0.6)'
            ]
        }]
    };
var option = {
tooltips: {
         enabled: false
    },
	 legend: {
        			display: false
				    }
};

var myBarChart = new Chart.Bar(ctx,{
	data:data,
  options:option
});

                    })
                });
                document.cookie="";
    }
    </script>
</body>

</html>